// Global KiddoVerse namespace
var KV = KV || {};
KV.UI = class UI { constructor(gameInst){this.game=gameInst;this.selectedBlockTypeName=Object.keys(KV.BLOCK_TYPES).find(key=>KV.BLOCK_TYPES[key]===this.game.currentBlockType)?.toLowerCase()||'grass';this.initThemeSelector();this.initBlockSelector();this.initMobileControlsDisplay();this.initChat();} initThemeSelector(){const themeBtns=document.querySelectorAll('.theme-button');if(!themeBtns.length){console.warn("Theme selector buttons not found!");return;}themeBtns.forEach(btn=>{if(btn.dataset.theme===this.game.currentThemeName){btn.classList.add('active-theme');}btn.addEventListener('click',(e)=>{const themeName=e.currentTarget.dataset.theme;this.game.changeTheme(themeName);});});} initBlockSelector(){const selEl=document.getElementById('block-selector');if(!selEl){console.error("Block selector UI element not found!");return;}const opts=selEl.getElementsByClassName('block-option');for(let opt of opts){opt.addEventListener('click',(e)=>{for(let o of opts){o.classList.remove('active');}e.currentTarget.classList.add('active');const bN=e.currentTarget.dataset.blockType.toUpperCase();if(KV.BLOCK_TYPES[bN]!==undefined){this.game.setCurrentBlockType(KV.BLOCK_TYPES[bN]);this.selectedBlockTypeName=bN.toLowerCase();}});}let initActOpt=selEl.querySelector(`.block-option[data-block-type="${this.selectedBlockTypeName}"]`);if(!initActOpt&&opts.length>0){initActOpt=opts[0];this.game.setCurrentBlockType(KV.BLOCK_TYPES[opts[0].dataset.blockType.toUpperCase()]);}if(initActOpt)initActOpt.classList.add('active');} initMobileControlsDisplay(){const mobCtrl=document.getElementById('mobile-controls');const crossH=document.getElementById('crosshair');const blkSel=document.getElementById('block-selector');const chatW=document.getElementById('chat-widget');if(!mobCtrl||!crossH||!blkSel||!chatW){console.error("One or more mobile UI elements not found!");return;}if(KV.isTouchDevice()){mobCtrl.style.display='block';if(crossH)crossH.style.display='none';if(blkSel)blkSel.style.bottom='180px';if(chatW)chatW.style.bottom='180px';}else{mobCtrl.style.display='none';if(crossH)crossH.style.display='block';if(blkSel)blkSel.style.bottom='20px';if(chatW)chatW.style.bottom='20px';}} initChat(){const cTog=document.getElementById('chat-toggle');const cWin=document.getElementById('chat-window');const cIn=document.getElementById('chat-input');const sBtn=document.getElementById('send-chat-button');const eBtn=document.getElementById('emoji-picker-button');const ePal=document.getElementById('emoji-palette');if(!cTog||!cWin||!cIn||!sBtn||!eBtn||!ePal){console.error("One or more chat UI elements not found!");return;}cTog.addEventListener('click',()=>{const isHid=cWin.style.display==='none'||cWin.style.display==='';cWin.style.display=isHid?'block':'none';if(isHid){cIn.focus();}else{cIn.blur();}});sBtn.addEventListener('click',()=>this.sendChatMessage());cIn.addEventListener('keypress',(e)=>{if(e.key==='Enter'){this.sendChatMessage();e.preventDefault();}});eBtn.addEventListener('click',(e)=>{e.stopPropagation();ePal.style.display=ePal.style.display==='none'||ePal.style.display===''?'grid':'none';});ePal.querySelectorAll('span').forEach(em=>{em.addEventListener('click',(e)=>{cIn.value+=e.target.textContent;ePal.style.display='none';cIn.focus();});});document.addEventListener('click',(e)=>{if(!ePal.contains(e.target)&&e.target!==eBtn&&ePal.style.display!=='none'){ePal.style.display='none';}});this.addChatMessage("System","Welcome to KiddoVerse! Choose a world and have fun! âœ¨");} sendChatMessage(){const input=document.getElementById('chat-input');const msg=input.value.trim();if(msg){this.addChatMessage("You",msg);input.value='';const safeMsg=this.filterMessage(msg);}} addChatMessage(sender,message){const msgCont=document.getElementById('chat-messages');if(!msgCont)return;const msgEl=document.createElement('p');const sMax=20;const mMax=150;const escHTML=(str)=>str.replace(/[&<>"']/g,m=>({'&':'&','<':'<','>':'>','"':'"',"'":'''}[m]));const sSend=escHTML(sender.substring(0,sMax));const sMsg=escHTML(message.substring(0,mMax));msgEl.innerHTML=`<strong>${sSend}:</strong> ${sMsg}`;msgCont.appendChild(msgEl);msgCont.scrollTop=msgCont.scrollHeight;} filterMessage(message){const badWords=["badword","ugly","stupid"];let filtMsg=message;badWords.forEach(word=>{const regex=new RegExp(`\\b${word}\\b`,'gi');filtMsg=filtMsg.replace(regex,'ðŸ’œðŸ’œðŸ’œ');});return filtMsg;}};
console.log("KiddoVerse Themes: UI class updated for theme selector.");
